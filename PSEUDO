from ib_async import *
util.startLoop()

ib = IB()
ib.connect('127.0.0.1', 7497, clientId=0)


sub = ScannerSubscription(
    instrument='STK', 
    locationCode='STK.NASDAQ',        # 'STK.US.MAJOR', 
    scanCode='TOP_PERC_GAIN')

tagValues = [
    TagValue("changePercAbove", "30"),
    TagValue('usdVolumeAbove', 0.10),
    TagValue('priceBelow', 10)]

# the tagValues are given as 3rd argument; the 2nd argument must always be an empty list
# (IB has not documented the 2nd argument and it's not clear what it does)
scanData = ib.reqScannerData(sub, [], tagValues)

symbols = [sd.contractDetails.contract.symbol for sd in scanData]
print(symbols)

ib.disconnect()
